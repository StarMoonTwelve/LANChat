# 局域网聊天程序

这是一个简单的局域网聊天程序，包括 WinForm 版和控制台版的客户端和服务端。用户可以通过该程序在局域网内进行聊天。
目前Winform版本相对完整。

## 目录

- [功能概述](#功能概述)
- [WinForm 版](#winform-版)
  - [功能说明](#功能说明)
  - [使用方法](#使用方法)
  - [代码结构](#代码结构)
- [控制台版](#控制台版)
  - [功能说明](#功能说明-1)
  - [使用方法](#使用方法-1)
  - [代码结构](#代码结构-1)
- [注意事项](#注意事项)
- [License](#license)

## 功能概述

- **局域网聊天**：用户可以在局域网内与其他用户进行实时聊天。
- **多客户端支持**：服务端可以处理多个客户端连接，并支持消息广播。
- **消息记录**：所有聊天记录会自动保存到日志文件中。

## WinForm 版

### 功能说明

WinForm 版包括客户端和服务端，提供了一个图形用户界面，用户可以通过界面启动和停止聊天服务器，以及连接到其他服务器进行聊天。

### 使用方法

#### 服务端

1. **启动程序**：打开 WinForm 聊天服务端，界面上会显示本机 IP 地址。
2. **输入端口号**：在端口号输入框中输入服务器的端口号（默认可使用 8888）。
3. **启动服务器**：
   - 点击“启动服务器”按钮，启动聊天服务器。
   - 点击“停止服务器”按钮，停止聊天服务器。
4. **查看聊天记录**：在标签页中查看不同端口的聊天记录。

#### 客户端

1. **启动程序**：打开 WinForm 聊天客户端，界面上会显示本机 IP 地址。
2. **输入用户名**：在用户名输入框中输入昵称，作为聊天时的显示名称。
3. **输入服务器信息**：
   - **IP 地址**：在 IP 地址输入框中输入要连接的服务器的 IP 地址。
   - **端口号**：在端口号输入框中输入服务器的端口号（默认可使用 8888）。
4. **连接服务器**：
   - 点击“连接”按钮，尝试连接到服务器。
   - 如果连接成功，程序会创建一个新标签页用于显示聊天记录，如果连接多个服务器，可在标签页面切换使用。
5. **发送消息**：
   - 在输入框中输入消息，然后按 Enter 键发送消息。
   - 可以通过 Shift + Enter 来实现换行。
6. **查看聊天记录**：在消息显示框中可以查看已发送和接收到的聊天记录。
7. **断开连接**：
   - 点击“断开”按钮，可以断开与服务器的连接。
   - 在断开连接后，可以再次输入新的服务器信息进行连接。

### 代码结构

#### 服务端
- `MainForm` 类：主窗口类，负责 UI 初始化和事件处理。
- `ListenForClients` 方法：接受客户端连接。
- `HandleClient` 方法：处理客户端消息。
- `LogMessage` 方法：记录聊天消息到文件。

#### 客户端
- `MainForm` 类：主窗口类，负责 UI 初始化和事件处理。
- `buttonConnect_Click` 方法：连接按钮事件，处理IP端口卡控，同时生成新标签页。
- `buttonDisconnect_Click` 方法：断开连接按钮事件。
- `Disconnect` 方法：具体端口断开方法，关闭连接，关闭标签页。
- `ReceiveMessages` 方法：复制接受从服务端传来的消息。
- `textBoxInputMessage_KeyDown` 方法：回车事件，准备发送消息。
- `SendMessage` 方法：发送消息。
- `AppendMessage` 方法：页面显示收到的消息。
- `GetLocalIPAddress` 方法：显示本机IP。

## 控制台版

### 功能说明

控制台版提供了一个简化的界面，用户通过控制台输入命令进行聊天。

### 使用方法

1. **启动服务端**：
   - 运行服务端程序，服务端会监听指定端口（默认端口为 8888）。
   - 服务端会接受来自客户端的连接请求，并处理消息。

2. **启动客户端**：
   - 运行客户端程序。
   - 系统会提示输入昵称，在控制台输入昵称后按 Enter。
   - 然后输入要连接的服务器信息，格式为 `服务器IP-端口`（例如：`192.168.0.1-8888`），按 Enter 确认。
   - 如果连接成功，控制台会显示“连接成功，可以愉快的聊天了...”的提示。

3. **发送消息**：
   - 输入聊天内容后按 Enter 键发送消息。
   - 所有用户都可以看到你发送的消息。

4. **查看聊天记录**：在控制台中，可以查看到自己发送和接收到的消息。

5. **退出程序**：在客户端中输入 `exit` 命令可以退出聊天。

### 代码结构

#### 服务端
- `Program` 类：包含 `Main` 方法和客户端、服务端的消息处理逻辑。
- `HandleClient` 方法：处理客户端连接和消息。
- `Broadcast` 方法：将消息发送给所有其他客户端。
- `LogMessage` 方法：记录聊天消息到文件。

#### 客户端
- `Program` 类：包含 `Main` 方法和客户端、服务端的消息处理逻辑。
- `ReceiveMessages` 方法：接受消息方法。
 
## 注意事项

- 确保防火墙允许指定端口的流量。
- 服务器和客户端应在同一局域网内。
- 日志文件会保存至程序的运行目录。
- 建议使用稳定的网络环境以避免连接中断。

## License

该项目使用 MIT 许可证，详情见 LICENSE 文件。
